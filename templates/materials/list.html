<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수업 자료 - Python 학습 플랫폼</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/materials.css">
</head>
<body>
    <nav>
        <div class="container">
            <a href="/" class="logo">🐍 Python 학습</a>
            <ul>
                <li><a href="/">홈</a></li>
                <li><a href="/materials">수업 자료</a></li>
                <li><a href="/practice">문제 풀이</a></li>
                <li><a href="/profile/history">내 기록</a></li>
                <li id="auth-nav"></li>
            </ul>
        </div>
    </nav>

    <div class="materials-header">
        <div class="container">
            <h1>📚 수업 자료</h1>
            <div class="materials-filters">
                <div class="filter-group">
                    <label for="category-filter">카테고리:</label>
                    <select id="category-filter">
                        <option value="">전체</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="difficulty-filter">난이도:</label>
                    <select id="difficulty-filter">
                        <option value="">전체</option>
                        <option value="beginner">초급</option>
                        <option value="intermediate">중급</option>
                        <option value="advanced">고급</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="error-message" class="alert alert-error"></div>
        <div id="loader" class="loader"></div>
        <div id="materials-list" class="materials-list"></div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/materials.js"></script>
    <script>
        // 네비게이션 메뉴 설정
        const authNav = document.getElementById('auth-nav');
        if (isLoggedIn()) {
            const user = getCurrentUser();
            authNav.innerHTML = `
                <span style="color: white; margin-right: 1rem;">👤 ${escapeHtml(user.username)}</span>
                <a href="#" onclick="AuthAPI.logout(); return false;">로그아웃</a>
            `;
        } else {
            authNav.innerHTML = '<a href="/login">로그인</a>';
        }

        // 카테고리 목록 로드
        async function loadCategories() {
            try {
                const response = await MaterialsAPI.getCategories();
                if (response.success) {
                    const select = document.getElementById('category-filter');
                    response.data.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('카테고리 로드 실패:', error);
            }
        }

        // 필터 변경 시 자료 다시 로드
        document.getElementById('category-filter').addEventListener('change', (e) => {
            const difficulty = document.getElementById('difficulty-filter').value;
            loadMaterials(e.target.value || null, difficulty || null);
        });

        document.getElementById('difficulty-filter').addEventListener('change', (e) => {
            const category = document.getElementById('category-filter').value;
            loadMaterials(category || null, e.target.value || null);
        });

        // 페이지 로드 시 실행
        loadCategories();
        loadMaterials();
    </script>
</body>
</html>

